# toolmodel Validation Pipeline
# JSON Schema validation flow

direction: right

vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 0
  }
  foundation-fill: "#718096"
  process-fill: "#3182ce"
  success-fill: "#38a169"
  error-fill: "#e53e3e"
}

classes: {
  input-node: {
    style: {
      fill: ${foundation-fill}
      stroke: "#4a5568"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  process-node: {
    style: {
      fill: ${process-fill}
      stroke: "#2c5282"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  success-node: {
    style: {
      fill: ${success-fill}
      stroke: "#276749"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  error-node: {
    style: {
      fill: ${error-fill}
      stroke: "#c53030"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  data-flow: {
    style: {
      stroke: "#4a5568"
      stroke-width: 2
    }
  }
  success-flow: {
    style: {
      stroke: ${success-fill}
      stroke-width: 2
    }
  }
  error-flow: {
    style: {
      stroke: ${error-fill}
      stroke-width: 2
      stroke-dash: 3
    }
  }
}

# Title
title: "toolmodel - Validation Pipeline" {
  shape: text
  near: top-center
  style: {
    font-size: 24
    bold: true
    font-color: "#1a365d"
  }
}

# Pipeline
input: "ðŸ“ Tool.InputSchema\nJSON Schema" {
  shape: document
  class: input-node
}

validator: "ðŸ” DefaultValidator\nSchema Compiler" {
  shape: hexagon
  class: process-node
}

resolve: "ðŸ“‹ Resolve Schema\nRef Resolution" {
  shape: step
  class: process-node
}

validate: "âœ“ Validate Instance\nInput Args" {
  shape: diamond
  class: process-node
}

success: "âœ… Success\nValid Input" {
  shape: step
  class: success-node
}

error: "âŒ Error\nValidation Failed" {
  shape: step
  class: error-node
}

# Flow
input -> validator: "schema" {
  class: data-flow
}
validator -> resolve: "compile" {
  class: data-flow
}
resolve -> validate: "resolved" {
  class: data-flow
}
validate -> success: "valid" {
  class: success-flow
}
validate -> error: "invalid" {
  class: error-flow
}
