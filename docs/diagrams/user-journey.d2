# toolmodel User Journey
# Tool authoring to execution flow

direction: down

vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 0
  }
  foundation-fill: "#718096"
  discovery-fill: "#3182ce"
  surface-fill: "#2b6cb0"
  execution-fill: "#38a169"
  actor-fill: "#e2e8f0"
}

classes: {
  actor: {
    style: {
      fill: ${actor-fill}
      stroke: "#a0aec0"
      stroke-width: 2
      font-color: "#1a202c"
      bold: true
    }
  }
  foundation: {
    style: {
      fill: ${foundation-fill}
      stroke: "#4a5568"
      stroke-width: 2
      font-color: "#fff"
      shadow: true
    }
  }
  discovery: {
    style: {
      fill: ${discovery-fill}
      stroke: "#2c5282"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  surface: {
    style: {
      fill: ${surface-fill}
      stroke: "#1a365d"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  execution: {
    style: {
      fill: ${execution-fill}
      stroke: "#276749"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  author-flow: {
    style: {
      stroke: ${foundation-fill}
      stroke-width: 2
    }
  }
  agent-flow: {
    style: {
      stroke: ${surface-fill}
      stroke-width: 2
    }
  }
}

# Title
title: "toolmodel - Tool Lifecycle" {
  shape: text
  near: top-center
  style: {
    font-size: 24
    bold: true
    font-color: "#1a365d"
  }
}

# Actors
author: "ðŸ‘¤ Author" {
  shape: person
  class: actor
}

agent: "ðŸ¤– Agent" {
  shape: person
  class: actor
}

# Components
toolmodel: "ðŸ“¦ toolmodel\nDefine Tool + Schema" {
  shape: package
  class: foundation
}

toolindex: "ðŸ—‚ï¸ toolindex\nRegister + Backend" {
  shape: cylinder
  class: discovery
}

tooldocs: "ðŸ“š tooldocs\nDocumentation" {
  shape: document
  class: discovery
}

metatools: "ðŸ”· metatools-mcp\nMCP Surface" {
  shape: hexagon
  class: surface
}

toolrun: "â–¶ï¸ toolrun\nExecution" {
  shape: step
  class: execution
}

# Author Flow
author -> toolmodel: "Define Tool + Schema" {
  class: author-flow
}
toolmodel -> toolindex: "Register Tool + Backend" {
  class: author-flow
}

# Agent Flow
agent -> metatools: "search_tools(query)" {
  class: agent-flow
}
metatools -> toolindex: "Search" {
  class: agent-flow
}

agent -> metatools: "describe_tool(id, schema)" {
  class: agent-flow
}
metatools -> tooldocs: "DescribeTool" {
  class: agent-flow
}

agent -> metatools: "run_tool(id, args)" {
  class: agent-flow
}
metatools -> toolrun: "Run" {
  class: agent-flow
}
